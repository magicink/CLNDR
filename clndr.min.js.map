{"version":3,"file":"clndr.min.js","sources":["../../src/ts/date-adapter/luxon-adapter.ts","../../src/ts/date-adapter/moment-adapter.ts","../../src/ts/state.ts","../../src/ts/templates.ts","../../src/ts/core.ts","../../src/ts/dom.ts","../../src/ts/date-adapter/adapter.ts","../../src/ts/config.ts","../../src/ts/facade.ts","../../src/ts/jquery-plugin.ts","../../src/ts/render.ts"],"sourcesContent":["import { DateTime, Info } from 'luxon'\n\nimport type {\n  AdapterDate,\n  DateAdapter,\n  DateUnit,\n  DurationLike,\n  WeekdayLabelStyle\n} from './adapter'\n\n/** AdapterDate implementation backed by Luxon DateTime. */\nclass LuxonAdapterDate implements AdapterDate<DateTime> {\n  constructor(\n    private dt: DateTime,\n    private owner: LuxonDateAdapter\n  ) {}\n\n  value(): DateTime {\n    return this.dt\n  }\n\n  toISO(): string {\n    return this.dt.toISO() || this.dt.toISODate()!\n  }\n\n  format(fmt: string): string {\n    // Special-case Moment's two-letter weekday token (dd). Luxon doesn't\n    // provide a direct token for this width, so derive from short name.\n    if (fmt === 'dd') {\n      const labels = Info.weekdays('short', { locale: this.owner.getLocale() })\n      const label = labels[this.dt.weekday - 1] || this.dt.toFormat('ccc')\n      return label.slice(0, 2)\n    }\n\n    const mapped = this.owner.normalizeTokens(fmt)\n    return this.dt.setLocale(this.owner.getLocale()).toFormat(mapped)\n  }\n\n  startOf(unit: DateUnit): AdapterDate<DateTime> {\n    if (unit === 'week') {\n      // Compute locale-aware week start within the same week as this.dt.\n      // Map locale firstDayOfWeek (0=Sun..6=Sat) to ISO (1=Mon..7=Sun).\n      const desired = this.owner.firstDayOfWeek()\n      const isoDesired = desired === 0 ? 7 : desired\n      const dowISO = this.dt.weekday // 1..7\n      const daysBack = (dowISO - isoDesired + 7) % 7\n      const adjusted = this.dt.minus({ days: daysBack }).startOf('day')\n      return new LuxonAdapterDate(adjusted, this.owner)\n    }\n    return new LuxonAdapterDate(this.dt.startOf(unit as any), this.owner)\n  }\n\n  endOf(unit: DateUnit): AdapterDate<DateTime> {\n    if (unit === 'week') {\n      const start = this.startOf('week') as LuxonAdapterDate\n      return new LuxonAdapterDate(\n        start.value().plus({ days: 6 }).endOf('day'),\n        this.owner\n      )\n    }\n    return new LuxonAdapterDate(this.dt.endOf(unit as any), this.owner)\n  }\n\n  plus(delta: DurationLike): AdapterDate<DateTime> {\n    return new LuxonAdapterDate(this.dt.plus(delta as any), this.owner)\n  }\n\n  minus(delta: DurationLike): AdapterDate<DateTime> {\n    return new LuxonAdapterDate(this.dt.minus(delta as any), this.owner)\n  }\n\n  weekday(): number {\n    // Luxon: 1..7 (Mon=1)\n    return this.dt.weekday\n  }\n\n  day(): number {\n    return this.dt.day\n  }\n\n  daysInMonth(): number {\n    return this.dt.daysInMonth\n  }\n\n  isBefore(other: AdapterDate<DateTime>): boolean {\n    return this.dt.toMillis() < (other as LuxonAdapterDate).value().toMillis()\n  }\n\n  isAfter(other: AdapterDate<DateTime>): boolean {\n    return this.dt.toMillis() > (other as LuxonAdapterDate).value().toMillis()\n  }\n\n  hasSame(other: AdapterDate<DateTime>, unit: DateUnit): boolean {\n    return this.dt.hasSame((other as LuxonAdapterDate).value(), unit as any)\n  }\n}\n\n/** DateAdapter implementation targeting Luxon DateTime. */\nexport class LuxonDateAdapter implements DateAdapter<DateTime> {\n  constructor(\n    private locale: string = 'en',\n    private zone?: string\n  ) {}\n\n  now(): AdapterDate<DateTime> {\n    const dt = DateTime.now().set({})\n    const localized = dt.setLocale(this.locale)\n    const zoned = this.zone ? localized.setZone(this.zone) : localized\n    return new LuxonAdapterDate(zoned, this)\n  }\n\n  fromISO(iso: string): AdapterDate<DateTime> {\n    const dt = DateTime.fromISO(iso, { locale: this.locale, zone: this.zone })\n    return new LuxonAdapterDate(dt, this)\n  }\n\n  fromFormat(text: string, fmt: string): AdapterDate<DateTime> {\n    const mapped = this.normalizeTokens(fmt)\n    const dt = DateTime.fromFormat(text, mapped, {\n      locale: this.locale,\n      zone: this.zone\n    })\n    return new LuxonAdapterDate(dt, this)\n  }\n\n  fromNative(value: DateTime): AdapterDate<DateTime> {\n    const dt = DateTime.isDateTime(value)\n      ? value\n      : DateTime.fromJSDate(value as unknown as Date, {\n          locale: this.locale,\n          zone: this.zone\n        })\n    const localized = dt.setLocale(this.locale)\n    const zoned = this.zone ? localized.setZone(this.zone) : localized\n    return new LuxonAdapterDate(zoned, this)\n  }\n\n  withLocale(locale: string): DateAdapter<DateTime> {\n    return new LuxonDateAdapter(locale, this.zone)\n  }\n\n  getLocale(): string {\n    return this.locale\n  }\n\n  /**\n   * Locale-based first day-of-week: 0..6 (0=Sunday).\n   * Luxon/Intl do not expose this uniformly across environments, so\n   * approximate with a small mapping aligned with Moment defaults used\n   * by our tests (en → Sunday, fr/de/en-GB → Monday).\n   */\n  firstDayOfWeek(): number {\n    const loc = (this.locale || 'en').toLowerCase()\n    if (\n      loc.startsWith('fr') ||\n      loc.startsWith('de') ||\n      loc.startsWith('en-gb')\n    ) {\n      return 1 // Monday\n    }\n    return 0 // Sunday (en, en-US, etc.)\n  }\n\n  setWeekday(\n    date: AdapterDate<DateTime>,\n    index: number\n  ): AdapterDate<DateTime> {\n    // Index is 0..6 relative to locale first day-of-week.\n    const base = (date as LuxonAdapterDate).value()\n    const start = new LuxonAdapterDate(base, this).startOf(\n      'week'\n    ) as LuxonAdapterDate\n    const target = start.value().plus({ days: ((index % 7) + 7) % 7 })\n    return new LuxonAdapterDate(target, this)\n  }\n\n  weekdayLabels(style: WeekdayLabelStyle): string[] {\n    // Luxon returns Monday-first arrays; reorder to start at locale first day.\n    const raw = Info.weekdays(style as any, { locale: this.locale })\n    const fdow = this.firstDayOfWeek() // 0..6 (0=Sun)\n    const startIndex = fdow === 0 ? 6 : fdow - 1\n    return [...raw.slice(startIndex), ...raw.slice(0, startIndex)]\n  }\n\n  /**\n   * Map common Moment tokens used by CLNDR to Luxon/ICU tokens.\n   * Only a minimal subset is required for our templates/tests.\n   */\n  normalizeTokens(fmt: string): string {\n    let out = fmt\n    // Years\n    out = out.replace(/YYYY/g, 'yyyy').replace(/YY/g, 'yy')\n    // Weekday names (avoid interfering with day-of-month D tokens)\n    out = out.replace(/dddd/g, 'cccc').replace(/ddd(?!d)/g, 'ccc')\n    // Months: protect MMMM first, then shorter tokens\n    out = out.replace(/MMMM/g, 'LLLL').replace(/MMM(?!M)/g, 'LLL')\n    out = out.replace(/MM(?!M)/g, 'LL').replace(/M(?!M)/g, 'L')\n    // Day of month\n    out = out.replace(/DD(?!D)/g, 'dd').replace(/D(?!D)/g, 'd')\n    return out\n  }\n}\n\n/** Factory for a LuxonDateAdapter bound to an optional locale/zone. */\nexport function createLuxonAdapter(\n  locale?: string,\n  zone?: string\n): DateAdapter<DateTime> {\n  return new LuxonDateAdapter(locale, zone)\n}\n","/**\n * Moment-based DateAdapter implementation.\n * Provides a compatibility layer that mirrors the legacy Moment usage in\n * CLNDR, enabling the core to speak via a stable adapter interface.\n */\nimport momentLib from 'moment'\nimport {\n  AdapterDate,\n  DateAdapter,\n  DateUnit,\n  DurationLike,\n  WeekdayLabelStyle\n} from './adapter'\n\n/** Underlying Moment instance type used by this adapter. */\ntype Moment = ReturnType<typeof momentLib>\n\n/** AdapterDate wrapper around a Moment instance. */\nclass MomentAdapterDate implements AdapterDate<Moment> {\n  constructor(private m: Moment) {}\n\n  /** Return the wrapped Moment instance. */\n  value(): Moment {\n    return this.m\n  }\n\n  /** Serialize to ISO string using Moment's toISOString(). */\n  toISO(): string {\n    return this.m.toISOString()\n  }\n\n  /** Format using Moment token syntax. */\n  format(fmt: string): string {\n    return this.m.format(fmt)\n  }\n\n  /** Non-mutating startOf boundary. */\n  startOf(unit: DateUnit): AdapterDate<Moment> {\n    return new MomentAdapterDate(this.m.clone().startOf(unit as any))\n  }\n\n  /** Non-mutating endOf boundary. */\n  endOf(unit: DateUnit): AdapterDate<Moment> {\n    return new MomentAdapterDate(this.m.clone().endOf(unit as any))\n  }\n\n  /** Add a duration (non-mutating). */\n  plus(delta: DurationLike): AdapterDate<Moment> {\n    const m = this.m.clone()\n    if (delta.milliseconds) m.add(delta.milliseconds, 'milliseconds')\n    if (delta.seconds) m.add(delta.seconds, 'seconds')\n    if (delta.minutes) m.add(delta.minutes, 'minutes')\n    if (delta.hours) m.add(delta.hours, 'hours')\n    if (delta.days) m.add(delta.days, 'days')\n    if (delta.weeks) m.add(delta.weeks, 'weeks')\n    if (delta.months) m.add(delta.months, 'months')\n    if (delta.years) m.add(delta.years, 'years')\n    return new MomentAdapterDate(m)\n  }\n\n  /** Subtract a duration (non-mutating). */\n  minus(delta: DurationLike): AdapterDate<Moment> {\n    const m = this.m.clone()\n    if (delta.milliseconds) m.subtract(delta.milliseconds, 'milliseconds')\n    if (delta.seconds) m.subtract(delta.seconds, 'seconds')\n    if (delta.minutes) m.subtract(delta.minutes, 'minutes')\n    if (delta.hours) m.subtract(delta.hours, 'hours')\n    if (delta.days) m.subtract(delta.days, 'days')\n    if (delta.weeks) m.subtract(delta.weeks, 'weeks')\n    if (delta.months) m.subtract(delta.months, 'months')\n    if (delta.years) m.subtract(delta.years, 'years')\n    return new MomentAdapterDate(m)\n  }\n\n  /** ISO weekday 1..7 (Mon=1, Sun=7). */\n  weekday(): number {\n    // ISO weekday 1..7 (Mon=1)\n    return this.m.isoWeekday()\n  }\n\n  day(): number {\n    return this.m.date()\n  }\n\n  daysInMonth(): number {\n    return this.m.daysInMonth()\n  }\n\n  isBefore(other: AdapterDate<Moment>): boolean {\n    return this.m.isBefore((other as MomentAdapterDate).value())\n  }\n\n  isAfter(other: AdapterDate<Moment>): boolean {\n    return this.m.isAfter((other as MomentAdapterDate).value())\n  }\n\n  hasSame(other: AdapterDate<Moment>, unit: DateUnit): boolean {\n    return this.m.isSame((other as MomentAdapterDate).value(), unit as any)\n  }\n}\n\n/** DateAdapter implementation targeting Moment.js. */\nexport class MomentDateAdapter implements DateAdapter<Moment> {\n  constructor(private locale: string = momentLib.locale()) {}\n\n  now(): AdapterDate<Moment> {\n    return new MomentAdapterDate(momentLib())\n  }\n\n  fromISO(iso: string): AdapterDate<Moment> {\n    return new MomentAdapterDate(momentLib(iso))\n  }\n\n  fromFormat(text: string, fmt: string): AdapterDate<Moment> {\n    return new MomentAdapterDate(momentLib(text, fmt))\n  }\n\n  fromNative(value: Moment): AdapterDate<Moment> {\n    return new MomentAdapterDate(momentLib(value))\n  }\n\n  withLocale(locale: string): DateAdapter<Moment> {\n    return new MomentDateAdapter(locale)\n  }\n\n  getLocale(): string {\n    return this.locale\n  }\n\n  /** Locale-based first day-of-week: 0..6 (0=Sunday). */\n  firstDayOfWeek(): number {\n    // 0..6, Sunday=0\n    return momentLib.localeData(this.locale).firstDayOfWeek()\n  }\n\n  /**\n   * Set weekday by locale-relative index (0 is locale first day-of-week)\n   * within the week of the provided base date.\n   */\n  setWeekday(date: AdapterDate<Moment>, index: number): AdapterDate<Moment> {\n    // index is 0..6 relative to locale firstDayOfWeek().\n    // Use locale-aware weekday() to stay within the same locale week\n    // of the provided base date.\n    // In moment, weekday(0) is the locale first day-of-week.\n    const targetDow = (((index % 7) + 7) % 7) as number\n    const m = (date as MomentAdapterDate).value().clone().weekday(targetDow)\n    return new MomentAdapterDate(m)\n  }\n\n  /** Localized weekday labels from moment's locale data. */\n  weekdayLabels(style: WeekdayLabelStyle): string[] {\n    const ld = momentLib.localeData(this.locale)\n    if (style === 'narrow') return ld.weekdaysMin()\n    if (style === 'short') return ld.weekdaysShort()\n    return ld.weekdays()\n  }\n\n  /** No-op for Moment; legacy tokens already match. */\n  normalizeTokens(fmt: string): string {\n    // Moment already uses legacy tokens used by CLNDR, no change needed\n    return fmt\n  }\n}\n\n/** Factory for a MomentDateAdapter bound to an optional locale. */\nexport function createMomentAdapter(locale?: string): DateAdapter<Moment> {\n  return new MomentDateAdapter(locale)\n}\n","import { AdapterDate, DateAdapter } from './date-adapter/adapter'\n\n/**\n * Immutable snapshot of calendar timing state derived from configuration.\n *\n * @template TNative Underlying date value type for the active adapter\n * @property month The anchor month for the current view (start of month)\n * @property intervalStart Inclusive start of the visible range\n * @property intervalEnd Inclusive end of the visible range (endOf('day'))\n * @property selectedDate Currently selected date, if any\n */\nexport interface CalendarState<TNative = unknown> {\n  month: AdapterDate<TNative>\n  intervalStart: AdapterDate<TNative>\n  intervalEnd: AdapterDate<TNative>\n  selectedDate: AdapterDate<TNative> | null\n}\n\n/**\n * Coerce a mixed input value (ISO string or native value) into an adapter date.\n *\n * - `null`/`undefined` → `adapter.now()`\n * - `string` → `adapter.fromISO(string)`\n * - otherwise → `adapter.fromNative(value)`\n *\n * @internal Utility used by state initialization\n */\nfunction parseToAdapterDate<T>(\n  adapter: DateAdapter<T>,\n  v: any\n): AdapterDate<T> {\n  if (v == null) return adapter.now()\n  if (typeof v === 'string') return adapter.fromISO(v)\n  return adapter.fromNative(v as any)\n}\n\n/**\n * Initialize calendar timing state from options using the provided DateAdapter.\n *\n * Semantics (parity with legacy CLNDR):\n * - Default view: single month anchored to `now()`, so\n *   `month = now().startOf('month')`, `intervalStart = month`,\n *   `intervalEnd = month.endOf('month')`.\n * - Months mode (`lengthOfTime.months`):\n *   - Anchor from `lengthOfTime.startDate`, else `startWithMonth`, else `now()`;\n *     take `.startOf('month')`.\n *   - Interval is inclusive: `start` through\n *     `start.plus({ months }).minus({ days: 1 }).endOf('day')`.\n * - Days mode (`lengthOfTime.days`):\n *   - Anchor from `lengthOfTime.startDate`, else `now()`; take `.startOf('day')`.\n *   - Align `intervalStart` to the requested weekday index according to\n *     `weekOffset` (0..6) within the same week as the anchor using\n *     `adapter.setWeekday(startOf('week'), weekOffset)`.\n *   - Interval is `days - 1` days after `intervalStart`, inclusive of end day.\n * - `startWithMonth` overrides the anchor month for any mode and recomputes\n *   `intervalEnd` based on `lengthOfTime` (days/months) or the end of that month.\n * - `selectedDate` is parsed when provided, else `null`.\n *\n * @template T Underlying adapter native type\n * @param adapter Active date adapter\n * @param options CLNDR options used to compute initial state\n * @returns Derived {@link CalendarState}\n */\nexport function initState<T>(\n  adapter: DateAdapter<T>,\n  options: ClndrOptions\n): CalendarState<T> {\n  const lot = options.lengthOfTime || {}\n  let month: AdapterDate<T>\n  let intervalStart: AdapterDate<T>\n  let intervalEnd: AdapterDate<T>\n\n  if (lot.months || lot.days) {\n    if (lot.months) {\n      // Months mode\n      const startMonth = (\n        lot.startDate\n          ? parseToAdapterDate(adapter, lot.startDate)\n          : options.startWithMonth\n            ? parseToAdapterDate(adapter, options.startWithMonth)\n            : adapter.now()\n      ).startOf('month')\n\n      intervalStart = startMonth\n      intervalEnd = startMonth\n        .plus({ months: lot.months as number })\n        .minus({ days: 1 })\n        .endOf('day')\n      month = startMonth\n    } else {\n      // Days mode\n      const startDay = (\n        lot.startDate\n          ? parseToAdapterDate(adapter, lot.startDate)\n          : adapter.now()\n      ).startOf('day')\n\n      // Align to the requested weekday within this week.\n      const base = startDay.startOf('week')\n      const weekOffset = options.weekOffset ?? 0\n      intervalStart = adapter.setWeekday(base, weekOffset)\n      intervalEnd = intervalStart\n        .plus({ days: (lot.days as number) - 1 })\n        .endOf('day')\n      month = intervalStart\n    }\n  } else {\n    // Default: single month view\n    month = adapter.now().startOf('month')\n    intervalStart = month\n    intervalEnd = month.endOf('month')\n  }\n\n  if (options.startWithMonth) {\n    month = parseToAdapterDate(adapter, options.startWithMonth).startOf('month')\n    intervalStart = month\n    const hasDays = !!options.lengthOfTime?.days\n    const hasMonths = !!options.lengthOfTime?.months\n    if (hasDays) {\n      intervalEnd = month\n        .plus({ days: (options.lengthOfTime!.days as number) - 1 })\n        .endOf('day')\n    } else if (hasMonths) {\n      intervalEnd = month\n        .plus({ months: options.lengthOfTime!.months as number })\n        .minus({ days: 1 })\n        .endOf('day')\n    } else {\n      intervalEnd = month.endOf('month')\n    }\n  }\n\n  const selectedDate = options.selectedDate\n    ? parseToAdapterDate(adapter, options.selectedDate)\n    : null\n\n  return { month, intervalStart, intervalEnd, selectedDate }\n}\n","import { DateAdapter } from './date-adapter/adapter'\n\n/**\n * Function that takes CLNDR template data and returns HTML.\n * Consumers may supply their own renderers; this is the minimal type.\n */\nexport type TemplateRenderer = (data: any) => string\n\n/**\n * Default CLNDR template borrowed from the legacy plugin. This keeps parity\n * for consumers that relied on the built-in markup.\n */\nexport const DEFAULT_TEMPLATE = `\n<div class='clndr-controls'>\n  <div class='clndr-control-button'>\n    <span class='clndr-previous-button'>previous</span>\n  </div>\n  <div class='month'><%= month %> <%= year %></div>\n  <div class='clndr-control-button rightalign'>\n    <span class='clndr-next-button'>next</span>\n  </div>\n</div>\n<table class='clndr-table' border='0' cellspacing='0' cellpadding='0'>\n  <thead>\n    <tr class='header-days'>\n      <% for(var i = 0; i < daysOfTheWeek.length; i++) { %>\n        <td class='header-day'><%= daysOfTheWeek[i] %></td>\n      <% } %>\n    </tr>\n  </thead>\n  <tbody>\n    <% for(var i = 0; i < numberOfRows; i++){ %>\n      <tr>\n        <% for(var j = 0; j < 7; j++){ %>\n          <% var d = j + i * 7; %>\n          <td class='<%= days[d].classes %>'>\n            <div class='day-contents'><%= days[d].day %></div>\n          </td>\n        <% } %>\n      </tr>\n    <% } %>\n  </tbody>\n</table>\n`.trim()\n\n/**\n * Very small, naive template compiler for internal tests/examples.\n * Supports replacing `<%= key %>` with stringified values from `data`.\n * Nested property access via dot notation is supported (e.g., `a.b.c`).\n */\nexport function compile(template: string): TemplateRenderer {\n  const re = /<%=\\s*([\\w.]+)\\s*%>/g\n  return (data: any) =>\n    template.replace(re, (_m, key) => {\n      const parts = String(key).split('.')\n      let cur: any = data\n      for (const p of parts) cur = cur?.[p]\n      return cur == null ? '' : String(cur)\n    })\n}\n\n/**\n * Construct a minimal CLNDR template data object with defaults for fields\n * that are expected by the stock template. Callers should then fill in\n * `days`, `month`, `year`, etc.\n */\nexport function baseTemplateData(\n  adapter: DateAdapter,\n  options: ClndrOptions\n): ClndrTemplateData {\n  return {\n    daysOfTheWeek: options.daysOfTheWeek || adapter.weekdayLabels('short'),\n    extras: options.extras,\n    days: [],\n    month: null,\n    year: null,\n    eventsThisMonth: [],\n    eventsLastMonth: [],\n    eventsNextMonth: [],\n    months: [],\n    numberOfRows: 0,\n    intervalStart: null,\n    intervalEnd: null,\n    eventsThisInterval: null\n  }\n}\n\n/**\n * Resolve the renderer function for a given CLNDR options object.\n * Priority:\n * 1) User-provided `render` callback.\n * 2) Provided `template` compiled via Underscore/Lodash `_.template` when available.\n * 3) Provided `template` compiled via the internal minimal compiler.\n * 4) Built-in default template compiled via the internal compiler.\n */\nexport function createRenderer(options: ClndrOptions): TemplateRenderer {\n  if (typeof options.render === 'function') {\n    return options.render\n  }\n\n  if (typeof options.template === 'string') {\n    const underscore = (globalThis as any)?._\n    if (underscore && typeof underscore.template === 'function') {\n      return underscore.template(options.template)\n    }\n    return compile(options.template)\n  }\n\n  // Fall back to the built-in template. If Underscore is present, prefer\n  // its full-featured template compiler so control-flow tags work as\n  // expected; otherwise, use the minimal internal compiler.\n  const underscore = (globalThis as any)?._\n  if (underscore && typeof underscore.template === 'function') {\n    return underscore.template(DEFAULT_TEMPLATE)\n  }\n  return compile(DEFAULT_TEMPLATE)\n}\n","import type { AdapterDate, DateAdapter } from './date-adapter/adapter'\nimport { initState, type CalendarState } from './state'\nimport { baseTemplateData } from './templates'\n\ntype RuntimeEvent<T = unknown> = ClndrEvent & {\n  _clndrStartDateObject: AdapterDate<T>\n  _clndrEndDateObject: AdapterDate<T>\n}\n\nexport interface ConstraintState {\n  next: boolean\n  previous: boolean\n  nextYear: boolean\n  previousYear: boolean\n  today: boolean\n}\n\nexport interface StateChange<T = unknown> {\n  previous: CalendarState<T>\n  current: CalendarState<T>\n}\n\nconst ISO_FORMAT = 'YYYY-MM-DD'\nconst WEEK_LENGTH = 7\nconst SIX_ROWS = WEEK_LENGTH * 6\n\n/**\n * Framework-agnostic CLNDR runtime implemented entirely in TypeScript.\n * This class encapsulates state transitions, event enrichment, constraint\n * validation, and template data construction. The DOM layer composes it to\n * provide the public API exposed by the facade and jQuery wrapper.\n */\nexport class ClndrCore<T = unknown> {\n  private readonly adapter: DateAdapter<T>\n  private options: ClndrOptions\n  private state: CalendarState<T>\n\n  private events: RuntimeEvent<T>[] = []\n  private eventsThisInterval: RuntimeEvent<T>[] = []\n  private eventsLastMonth: RuntimeEvent<T>[] = []\n  private eventsNextMonth: RuntimeEvent<T>[] = []\n\n  private constraintState: ConstraintState = {\n    next: true,\n    previous: true,\n    nextYear: true,\n    previousYear: true,\n    today: true\n  }\n\n  private constraintStart: AdapterDate<T> | null = null\n  private constraintEnd: AdapterDate<T> | null = null\n  private currentIntervalStart: AdapterDate<T> | null = null\n\n  constructor(adapter: DateAdapter<T>, options: ClndrOptions) {\n    this.adapter = adapter\n    this.options = ensureLengthDefaults(options)\n    this.state = initState(adapter, this.options)\n    this.bootstrapConstraints()\n    this.setEvents(this.options.events || [])\n  }\n\n  getOptions(): ClndrOptions {\n    return this.options\n  }\n\n  getState(): CalendarState<T> {\n    return this.state\n  }\n\n  getConstraints(): ConstraintState {\n    this.updateConstraintState()\n    return this.constraintState\n  }\n\n  private usesDaysInterval(): boolean {\n    return Boolean(this.options.lengthOfTime?.days)\n  }\n\n  private usesMonthsInterval(): boolean {\n    return Boolean(this.options.lengthOfTime?.months)\n  }\n\n  setExtras(extras: any): void {\n    this.options.extras = extras\n  }\n\n  setEvents(events: ClndrEvent[]): void {\n    const processed = this.options.multiDayEvents\n      ? this.addMultiDayDateObjects(events)\n      : this.addDateObjects(events)\n    this.events = processed\n    this.options.events = processed\n  }\n\n  addEvents(events: ClndrEvent[]): void {\n    const processed = this.options.multiDayEvents\n      ? this.addMultiDayDateObjects(events)\n      : this.addDateObjects(events)\n    this.events = [...this.events, ...processed]\n    this.options.events = this.events\n  }\n\n  removeEvents(match: (event: ClndrEvent) => boolean): void {\n    this.events = this.events.filter(ev => !match(ev))\n    this.options.events = this.events\n  }\n\n  setSelectedDate(value: string | AdapterDate<T> | null): void {\n    if (!value) {\n      this.options.selectedDate = null\n      return\n    }\n    if (typeof value === 'string') {\n      this.options.selectedDate = value\n      return\n    }\n    this.options.selectedDate = value.format\n      ? value.format(ISO_FORMAT)\n      : value.toISO()\n  }\n\n  forward(step?: number): StateChange<T> | null {\n    this.updateConstraintState()\n    if (!this.constraintState.next) return null\n    const interval = step ?? this.options.lengthOfTime?.interval ?? 1\n    return this.updateState(prev => {\n      if (this.usesDaysInterval()) {\n        const start = prev.intervalStart.plus({ days: interval }).startOf('day')\n        const span = (this.options.lengthOfTime?.days || 1) - 1\n        const end = start.plus({ days: span }).endOf('day')\n        return { ...prev, month: start, intervalStart: start, intervalEnd: end }\n      }\n      const start = prev.intervalStart\n        .plus({ months: interval })\n        .startOf('month')\n      const span = this.options.lengthOfTime?.months || interval\n      const end = start.plus({ months: span }).minus({ days: 1 }).endOf('month')\n      return { ...prev, month: start, intervalStart: start, intervalEnd: end }\n    })\n  }\n\n  back(step?: number): StateChange<T> | null {\n    this.updateConstraintState()\n    if (!this.constraintState.previous) return null\n    const interval = step ?? this.options.lengthOfTime?.interval ?? 1\n    return this.updateState(prev => {\n      if (this.usesDaysInterval()) {\n        const start = prev.intervalStart\n          .minus({ days: interval })\n          .startOf('day')\n        const span = (this.options.lengthOfTime?.days || 1) - 1\n        const end = start.plus({ days: span }).endOf('day')\n        return { ...prev, month: start, intervalStart: start, intervalEnd: end }\n      }\n      const start = prev.intervalStart\n        .minus({ months: interval })\n        .startOf('month')\n      const span = this.options.lengthOfTime?.months || interval\n      const end = start.plus({ months: span }).minus({ days: 1 }).endOf('month')\n      return { ...prev, month: start, intervalStart: start, intervalEnd: end }\n    })\n  }\n\n  nextYear(): StateChange<T> | null {\n    this.updateConstraintState()\n    if (!this.constraintState.nextYear) return null\n    return this.updateState(prev => {\n      const start = prev.intervalStart.plus({ years: 1 })\n      const end = prev.intervalEnd.plus({ years: 1 })\n      const month = prev.month.plus({ years: 1 })\n      return { ...prev, month, intervalStart: start, intervalEnd: end }\n    })\n  }\n\n  previousYear(): StateChange<T> | null {\n    this.updateConstraintState()\n    if (!this.constraintState.previousYear) return null\n    return this.updateState(prev => {\n      const start = prev.intervalStart.minus({ years: 1 })\n      const end = prev.intervalEnd.minus({ years: 1 })\n      const month = prev.month.minus({ years: 1 })\n      return { ...prev, month, intervalStart: start, intervalEnd: end }\n    })\n  }\n\n  today(): StateChange<T> {\n    return this.updateState(prev => {\n      const now = this.adapter.now()\n      if (this.usesDaysInterval()) {\n        const lot = this.options.lengthOfTime || {}\n        let start: AdapterDate<T>\n        if (lot.startDate) {\n          const ref = this.parseDateInput(lot.startDate)\n          const index = this.weekdayIndex(ref)\n          const base = now.startOf('week')\n          start = this.adapter.setWeekday(base, index)\n        } else {\n          const offset = this.options.weekOffset ?? 0\n          const base = now.startOf('week')\n          start = this.adapter.setWeekday(base, offset)\n        }\n        const span = (lot.days || 1) - 1\n        const end = start.plus({ days: span }).endOf('day')\n        return { ...prev, month: start, intervalStart: start, intervalEnd: end }\n      }\n      const start = now.startOf('month')\n      const span =\n        this.options.lengthOfTime?.months ||\n        this.options.lengthOfTime?.interval ||\n        1\n      const end = start.plus({ months: span }).minus({ days: 1 }).endOf('month')\n      return { ...prev, month: start, intervalStart: start, intervalEnd: end }\n    })\n  }\n\n  setMonth(newMonth: number | string): StateChange<T> | null {\n    if (this.usesDaysInterval() || this.usesMonthsInterval()) {\n      console.warn(\n        'CLNDR: setMonth is only supported for single-month calendars.'\n      )\n      return null\n    }\n    return this.updateState(prev => {\n      const year = Number(prev.month.format('YYYY'))\n      const target = this.resolveMonthDate(newMonth, year)\n      const start = target.startOf('month')\n      const end = start.endOf('month')\n      return { ...prev, month: start, intervalStart: start, intervalEnd: end }\n    })\n  }\n\n  setYear(newYear: number): StateChange<T> {\n    return this.updateState(prev => {\n      const monthIndex = Number(prev.month.format('M')) - 1\n      const iso = `${newYear}-${padMonth(monthIndex + 1)}-01`\n      const month = this.adapter.fromISO(iso).startOf('month')\n      const end = month.endOf('month')\n      return { ...prev, month, intervalStart: month, intervalEnd: end }\n    })\n  }\n\n  setIntervalStart(newDate: any): StateChange<T> | null {\n    if (\n      !this.options.lengthOfTime?.days &&\n      !this.options.lengthOfTime?.months\n    ) {\n      console.warn(\n        'CLNDR: setIntervalStart is only available when using lengthOfTime.'\n      )\n      return null\n    }\n    const parsed = this.parseDateInput(newDate)\n    return this.updateState(prev => {\n      if (this.usesDaysInterval()) {\n        const start = parsed.startOf('day')\n        const span = (this.options.lengthOfTime?.days || 1) - 1\n        const end = start.plus({ days: span }).endOf('day')\n        return { ...prev, month: start, intervalStart: start, intervalEnd: end }\n      }\n      const start = parsed.startOf('month')\n      const span =\n        this.options.lengthOfTime?.months ||\n        this.options.lengthOfTime?.interval ||\n        1\n      const end = start.plus({ months: span }).minus({ days: 1 }).endOf('month')\n      return { ...prev, month: start, intervalStart: start, intervalEnd: end }\n    })\n  }\n\n  buildTemplateData(): ClndrTemplateData {\n    const base = baseTemplateData(this.adapter, this.options)\n    const data: ClndrTemplateData = { ...base }\n\n    if (this.usesDaysInterval()) {\n      const days = this.createDaysObject(\n        this.state.intervalStart,\n        this.state.intervalEnd\n      )\n      data.days = days\n      data.month = null\n      data.year = null\n      data.intervalStart = this.state.intervalStart.value()\n      data.intervalEnd = this.state.intervalEnd.value()\n      data.numberOfRows = Math.ceil(days.length / WEEK_LENGTH)\n      data.eventsThisInterval = this.eventsThisInterval\n      data.eventsLastMonth = []\n      data.eventsNextMonth = []\n    } else if (this.usesMonthsInterval()) {\n      const months: ClndrTemplateMonthBlock[] = []\n      const intervalEvents: RuntimeEvent<T>[][] = []\n      let rows = 0\n      const count = this.options.lengthOfTime?.months || 0\n      for (let i = 0; i < count; i++) {\n        const start = this.state.intervalStart\n          .plus({ months: i })\n          .startOf('month')\n        const end = start.endOf('month')\n        const days = this.createDaysObject(start, end)\n        months.push({ days, month: start.value() as any })\n        intervalEvents.push([...this.eventsThisInterval])\n        rows += Math.ceil(days.length / WEEK_LENGTH)\n      }\n      data.days = []\n      data.months = months\n      data.numberOfRows = rows\n      data.eventsThisInterval = intervalEvents\n      data.intervalStart = this.state.intervalStart.value()\n      data.intervalEnd = this.state.intervalEnd.value()\n    } else {\n      const monthStart = this.state.month.startOf('month')\n      const monthEnd = monthStart.endOf('month')\n      const days = this.createDaysObject(monthStart, monthEnd)\n      data.days = days\n      data.month = this.state.month.format\n        ? this.state.month.format('MMMM')\n        : ''\n      data.year = this.state.month.format ? this.state.month.format('YYYY') : ''\n      data.eventsThisMonth = this.eventsThisInterval\n      data.numberOfRows = Math.ceil(days.length / WEEK_LENGTH)\n      data.eventsLastMonth = this.eventsLastMonth\n      data.eventsNextMonth = this.eventsNextMonth\n    }\n\n    return data\n  }\n\n  private updateState(\n    mutator: (prev: CalendarState<T>) => CalendarState<T>\n  ): StateChange<T> {\n    const previous = { ...this.state }\n    this.state = mutator(this.state)\n    this.updateConstraintState()\n    return { previous, current: this.state }\n  }\n\n  private parseDateInput(value: any): AdapterDate<T> {\n    if (!value) return this.adapter.now()\n    if (typeof value === 'string') return this.adapter.fromISO(value)\n    if (typeof value === 'number') {\n      return this.adapter.fromNative(new Date(value) as any)\n    }\n    if (typeof value === 'object') {\n      if (value.value && typeof value.value === 'function') {\n        return this.adapter.fromNative(value.value())\n      }\n      if (typeof value.toISOString === 'function') {\n        return this.adapter.fromISO(value.toISOString())\n      }\n    }\n    return this.adapter.fromNative(value as T)\n  }\n\n  private addDateObjects(events: ClndrEvent[]): RuntimeEvent<T>[] {\n    const key = this.options.dateParameter || 'date'\n    return events.map(ev => {\n      const start = this.parseDateInput((ev as any)[key])\n      const runtime = ev as RuntimeEvent<T>\n      runtime._clndrStartDateObject = start\n      runtime._clndrEndDateObject = start\n      return runtime\n    })\n  }\n\n  private addMultiDayDateObjects(events: ClndrEvent[]): RuntimeEvent<T>[] {\n    const config = this.options.multiDayEvents!\n    return events.map(ev => {\n      const runtime = ev as RuntimeEvent<T>\n      const startRaw =\n        (ev as any)[config.startDate] ??\n        (config.singleDay ? (ev as any)[config.singleDay] : null)\n      const endRaw =\n        (ev as any)[config.endDate] ??\n        (config.singleDay ? (ev as any)[config.singleDay] : null)\n      const start = this.parseDateInput(startRaw || endRaw)\n      const end = this.parseDateInput(endRaw || startRaw)\n      runtime._clndrStartDateObject = start\n      runtime._clndrEndDateObject = end\n      return runtime\n    })\n  }\n\n  private eventsInRange(\n    events: RuntimeEvent<T>[],\n    start: AdapterDate<T>,\n    end: AdapterDate<T>\n  ): RuntimeEvent<T>[] {\n    const startDay = start.startOf('day')\n    const endDay = end.endOf('day')\n    return events.filter(ev => {\n      const beforeStart = ev._clndrEndDateObject.isBefore(startDay)\n      const afterEnd = ev._clndrStartDateObject.isAfter(endDay)\n      return !(beforeStart || afterEnd)\n    })\n  }\n\n  private createDaysObject(\n    startDate: AdapterDate<T>,\n    endDate: AdapterDate<T>\n  ): ClndrDay[] {\n    const days: ClndrDay[] = []\n    const start = startDate.startOf('day')\n    const end = endDate.endOf('day')\n    this.currentIntervalStart = start\n    this.eventsThisInterval = this.eventsInRange(this.events, start, end)\n\n    if (!this.usesDaysInterval() && this.options.showAdjacentMonths) {\n      const base = start.startOf('month')\n      const lastMonthStart = base.minus({ months: 1 })\n      const lastMonthEnd = lastMonthStart.endOf('month')\n      const nextMonthStart = base.plus({ months: 1 })\n      const nextMonthEnd = nextMonthStart.endOf('month')\n      this.eventsLastMonth = this.eventsInRange(\n        this.events,\n        lastMonthStart,\n        lastMonthEnd\n      )\n      this.eventsNextMonth = this.eventsInRange(\n        this.events,\n        nextMonthStart,\n        nextMonthEnd\n      )\n    } else {\n      this.eventsLastMonth = []\n      this.eventsNextMonth = []\n    }\n\n    if (!this.usesDaysInterval()) {\n      const offset = this.options.weekOffset ?? 0\n      let diff = this.weekdayIndex(start) - offset\n      if (diff < 0) diff += WEEK_LENGTH\n      if (this.options.showAdjacentMonths) {\n        for (let i = diff; i > 0; i--) {\n          const filler = start.minus({ days: i })\n          days.push(this.createDayObject(filler, this.eventsLastMonth))\n        }\n      } else {\n        for (let i = 0; i < diff; i++) {\n          days.push(\n            this.calendarDay({\n              classes:\n                `${this.targetsEmpty()} ${this.options.classes?.lastMonth || ''}`.trim()\n            })\n          )\n        }\n      }\n    }\n\n    let cursor = start\n    while (!cursor.isAfter(end)) {\n      days.push(this.createDayObject(cursor, this.eventsThisInterval))\n      cursor = cursor.plus({ days: 1 })\n    }\n\n    if (!this.usesDaysInterval()) {\n      while (days.length % WEEK_LENGTH !== 0) {\n        if (this.options.showAdjacentMonths) {\n          days.push(this.createDayObject(cursor, this.eventsNextMonth))\n        } else {\n          days.push(\n            this.calendarDay({\n              classes:\n                `${this.targetsEmpty()} ${this.options.classes?.nextMonth || ''}`.trim()\n            })\n          )\n        }\n        cursor = cursor.plus({ days: 1 })\n      }\n    }\n\n    if (this.options.forceSixRows && days.length < SIX_ROWS) {\n      while (days.length < SIX_ROWS) {\n        if (this.options.showAdjacentMonths) {\n          days.push(this.createDayObject(cursor, this.eventsNextMonth))\n        } else {\n          days.push(\n            this.calendarDay({\n              classes:\n                `${this.targetsEmpty()} ${this.options.classes?.nextMonth || ''}`.trim()\n            })\n          )\n        }\n        cursor = cursor.plus({ days: 1 })\n      }\n    }\n\n    return days\n  }\n\n  private createDayObject(\n    day: AdapterDate<T>,\n    monthEvents: RuntimeEvent<T>[]\n  ): ClndrDay {\n    const dayStart = day.startOf('day')\n    const dayEnd = day.endOf('day')\n    const eventsToday = monthEvents.filter(ev => {\n      const beforeStart = ev._clndrEndDateObject.isBefore(dayStart)\n      const afterEnd = ev._clndrStartDateObject.isAfter(dayEnd)\n      return !(beforeStart || afterEnd)\n    })\n\n    const classes: string[] = [this.targetsDay()]\n    const properties: ClndrDay['properties'] = {\n      isToday: false,\n      isInactive: false,\n      isAdjacentMonth: false\n    }\n\n    const now = this.adapter.now()\n    if (day.hasSame(now, 'day')) {\n      classes.push(this.options.classes?.today || 'today')\n      properties.isToday = true\n    }\n\n    const nowStart = now.startOf('day')\n    if (dayEnd.isBefore(nowStart)) {\n      classes.push(this.options.classes?.past || 'past')\n    }\n\n    if (eventsToday.length) {\n      classes.push(this.options.classes?.event || 'event')\n    }\n\n    if (!this.usesDaysInterval() && this.currentIntervalStart) {\n      const monthStart = this.currentIntervalStart.startOf('month')\n      const monthEnd = monthStart.endOf('month')\n      if (day.isBefore(monthStart)) {\n        classes.push(this.options.classes?.adjacentMonth || 'adjacent-month')\n        classes.push(this.options.classes?.lastMonth || 'last-month')\n        properties.isAdjacentMonth = true\n      } else if (day.isAfter(monthEnd)) {\n        classes.push(this.options.classes?.adjacentMonth || 'adjacent-month')\n        classes.push(this.options.classes?.nextMonth || 'next-month')\n        properties.isAdjacentMonth = true\n      }\n    }\n\n    if (this.constraintStart && day.isBefore(this.constraintStart)) {\n      classes.push(this.options.classes?.inactive || 'inactive')\n      properties.isInactive = true\n    }\n    if (this.constraintEnd && day.isAfter(this.constraintEnd)) {\n      classes.push(this.options.classes?.inactive || 'inactive')\n      properties.isInactive = true\n    }\n\n    if (this.options.selectedDate) {\n      const selected = this.parseDateInput(this.options.selectedDate)\n      if (day.hasSame(selected, 'day')) {\n        classes.push(this.options.classes?.selected || 'selected')\n      }\n    }\n\n    classes.push(`calendar-day-${day.format(ISO_FORMAT)}`)\n    classes.push(`calendar-dow-${this.weekdayIndex(day)}`)\n\n    return this.calendarDay({\n      date: day.value(),\n      day: day.day(),\n      events: eventsToday,\n      properties,\n      classes: classes.join(' ').trim()\n    })\n  }\n\n  private calendarDay(partial: Partial<ClndrDay>): ClndrDay {\n    return {\n      day: partial.day ?? 0,\n      date: partial.date ?? null,\n      events: partial.events ?? [],\n      classes: partial.classes ?? this.targetsEmpty(),\n      properties: partial.properties\n    }\n  }\n\n  private targetsDay(): string {\n    return this.options.targets?.day || 'day'\n  }\n\n  private targetsEmpty(): string {\n    return this.options.targets?.empty || 'empty'\n  }\n\n  private weekdayIndex(date: AdapterDate<T>): number {\n    const isoZero = date.weekday() % WEEK_LENGTH\n    const localeStart = this.adapter.firstDayOfWeek()\n    let relative = isoZero - localeStart\n    if (relative < 0) relative += WEEK_LENGTH\n    return relative\n  }\n\n  private bootstrapConstraints(): void {\n    if (!this.options.constraints) return\n    if (this.options.constraints.startDate) {\n      this.constraintStart = this.parseDateInput(\n        this.options.constraints.startDate\n      ).startOf('day')\n    }\n    if (this.options.constraints.endDate) {\n      this.constraintEnd = this.parseDateInput(\n        this.options.constraints.endDate\n      ).endOf('day')\n    }\n    this.updateConstraintState()\n  }\n\n  private updateConstraintState(): void {\n    const state: ConstraintState = {\n      next: true,\n      previous: true,\n      nextYear: true,\n      previousYear: true,\n      today: true\n    }\n\n    if (!this.constraintStart && !this.constraintEnd) {\n      this.constraintState = state\n      return\n    }\n\n    const start = this.constraintStart\n    const end = this.constraintEnd\n    const oneYearAgo = this.state.intervalStart.minus({ years: 1 })\n    const oneYearFromEnd = this.state.intervalEnd.plus({ years: 1 })\n\n    if (start) {\n      const disablePrev =\n        start.isAfter(this.state.intervalStart) ||\n        (this.usesDaysInterval()\n          ? start.hasSame(this.state.intervalStart, 'day')\n          : start.hasSame(this.state.intervalStart, 'month'))\n      if (disablePrev) state.previous = false\n      if (start.isAfter(oneYearAgo)) state.previousYear = false\n    }\n\n    if (end) {\n      const disableNext =\n        end.isBefore(this.state.intervalEnd) ||\n        (this.usesDaysInterval()\n          ? end.hasSame(this.state.intervalEnd, 'day')\n          : end.hasSame(this.state.intervalEnd, 'month'))\n      if (disableNext) state.next = false\n      if (end.isBefore(oneYearFromEnd)) state.nextYear = false\n    }\n\n    const now = this.adapter.now().startOf('month')\n    if ((start && start.isAfter(now)) || (end && end.isBefore(now))) {\n      state.today = false\n    }\n\n    this.constraintState = state\n  }\n\n  private resolveMonthDate(\n    input: number | string,\n    year: number\n  ): AdapterDate<T> {\n    if (typeof input === 'number') {\n      const iso = `${year}-${padMonth(input + 1)}-01`\n      return this.adapter.fromISO(iso)\n    }\n\n    const tokens = ['MMMM YYYY', 'MMM YYYY']\n    for (const fmt of tokens) {\n      try {\n        return this.adapter.fromFormat(`${input} ${year}`, fmt)\n      } catch {\n        // continue\n      }\n    }\n    return this.adapter.fromISO(`${year}-01-01`)\n  }\n}\n\nfunction ensureLengthDefaults(options: ClndrOptions): ClndrOptions {\n  if (!options.lengthOfTime) {\n    options.lengthOfTime = { days: null, months: null, interval: 1 }\n  } else if (options.lengthOfTime.interval == null) {\n    options.lengthOfTime.interval = 1\n  }\n  return options\n}\n\nfunction padMonth(value: number): string {\n  return value < 10 ? `0${value}` : String(value)\n}\n","import $ from 'jquery'\n\nimport type { AdapterDate, DateAdapter } from './date-adapter/adapter'\nimport type { ClndrCore, ConstraintState, StateChange } from './core'\nimport type { TemplateRenderer } from './templates'\n\ntype RuntimeEvent = ClndrEvent & {\n  _clndrStartDateObject?: any\n  _clndrEndDateObject?: any\n}\n\n/**\n * DOM integration layer for CLNDR's TypeScript core.\n * Responsible for templated rendering, event delegation, and callback wiring.\n */\nexport class ClndrDOM<T = unknown> {\n  public readonly element: JQuery\n\n  private readonly core: ClndrCore<T>\n  private readonly renderer: TemplateRenderer\n  private readonly adapter: DateAdapter<T>\n  private readonly container: JQuery\n  private readonly options: ClndrOptions\n  private readonly eventType: string\n  private readonly eventName: string\n\n  private apiContext: Clndr | null = null\n\n  constructor(\n    element: HTMLElement | JQuery | string,\n    core: ClndrCore<T>,\n    renderer: TemplateRenderer,\n    adapter: DateAdapter<T>\n  ) {\n    this.core = core\n    this.renderer = renderer\n    this.adapter = adapter\n    this.options = core.getOptions()\n    this.element = this.resolveElement(element)\n    this.assertSingleElement(this.element)\n    this.element.html(\"<div class='clndr'></div>\")\n    this.container = this.element.find('.clndr')\n    this.eventType = this.options.useTouchEvents ? 'touchstart' : 'click'\n    this.eventName = `${this.eventType}.clndr`\n    this.bindEvents()\n  }\n\n  attachApi(api: Clndr): void {\n    this.apiContext = api\n  }\n\n  render(): void {\n    const data = this.core.buildTemplateData()\n    const html = this.renderer(data)\n    this.container.html(html)\n    this.applyConstraintClasses()\n    if (typeof this.options.doneRendering === 'function') {\n      this.options.doneRendering.apply(this.apiContext ?? this, [])\n    }\n  }\n\n  applyChange(\n    change: StateChange<T>,\n    opts: { action?: 'today'; fireCallbacks?: boolean } = {}\n  ): void {\n    this.render()\n    const fireCallbacks = opts.fireCallbacks !== false\n\n    if (\n      opts.action === 'today' &&\n      fireCallbacks &&\n      this.options.clickEvents?.today\n    ) {\n      this.options.clickEvents.today.apply(this.apiContext ?? this, [\n        change.current.month.value()\n      ])\n    }\n    if (fireCallbacks) {\n      this.triggerEvents(change)\n    }\n  }\n\n  destroy(): void {\n    this.element.off('.clndr')\n    this.container.remove()\n  }\n\n  private bindEvents(): void {\n    const targets = this.options.targets!\n    const eventName = this.eventName\n    this.element.off('.clndr')\n\n    this.element.on(eventName, `.${targets.day}`, event =>\n      this.handleDayClick(event)\n    )\n    this.element.on(eventName, `.${targets.empty}`, event =>\n      this.handleEmptyClick(event)\n    )\n    this.element.on(eventName, `.${targets.nextButton}`, event => {\n      event.preventDefault()\n      this.handleNavigation('forward')\n    })\n    this.element.on(eventName, `.${targets.previousButton}`, event => {\n      event.preventDefault()\n      this.handleNavigation('back')\n    })\n    this.element.on(eventName, `.${targets.nextYearButton}`, event => {\n      event.preventDefault()\n      this.handleNavigation('nextYear')\n    })\n    this.element.on(eventName, `.${targets.previousYearButton}`, event => {\n      event.preventDefault()\n      this.handleNavigation('previousYear')\n    })\n    this.element.on(eventName, `.${targets.todayButton}`, event => {\n      event.preventDefault()\n      this.handleNavigation('today')\n    })\n  }\n\n  private handleDayClick(event: JQuery.TriggeredEvent): void {\n    const target = this.resolveEventElement(\n      event,\n      `.${this.options.targets?.day || 'day'}`\n    )\n    if (!target) return\n    const $target = $(target)\n    const adjacentHandled = this.handleAdjacentDay(\n      $target as JQuery<HTMLElement>\n    )\n\n    if (this.options.trackSelectedDate && adjacentHandled !== true) {\n      const inactiveClass = this.options.classes?.inactive || 'inactive'\n      const selectedClass = this.options.classes?.selected || 'selected'\n      const selectedTokens = selectedClass.split(/\\s+/).filter(Boolean)\n      const isInactive = $target.hasClass(inactiveClass)\n      const ignoreInactive = this.options.ignoreInactiveDaysInSelection === true\n      if (!isInactive || !ignoreInactive) {\n        const iso = this.getTargetDateString(target)\n        if (iso) {\n          this.core.setSelectedDate(iso)\n          for (const token of selectedTokens) {\n            this.container.find(`.${token}`).removeClass(token)\n            if (token) {\n              target.classList.remove(token)\n            }\n          }\n          this.highlightSelectedDay(iso, selectedClass, selectedTokens)\n          $target.addClass(selectedClass)\n          target.className = `${target.className} ${selectedClass}`.trim()\n        }\n      }\n    }\n\n    if (this.options.clickEvents?.click) {\n      const payload = this.buildTargetObject(target, true)\n      this.options.clickEvents.click.apply(this.apiContext ?? this, [payload])\n    }\n  }\n\n  private handleEmptyClick(event: JQuery.TriggeredEvent): void {\n    const target = this.resolveEventElement(\n      event,\n      `.${this.options.targets?.empty || 'empty'}`\n    )\n    if (!target) return\n    const $target = $(target)\n    this.handleAdjacentDay($target as JQuery<HTMLElement>)\n\n    if (this.options.clickEvents?.click) {\n      const payload = this.buildTargetObject(target, false)\n      this.options.clickEvents.click.apply(this.apiContext ?? this, [payload])\n    }\n  }\n\n  private handleNavigation(\n    action: 'forward' | 'back' | 'nextYear' | 'previousYear' | 'today'\n  ): void {\n    let change: StateChange<T> | null = null\n    switch (action) {\n      case 'forward':\n        change = this.core.forward()\n        break\n      case 'back':\n        change = this.core.back()\n        break\n      case 'nextYear':\n        change = this.core.nextYear()\n        break\n      case 'previousYear':\n        change = this.core.previousYear()\n        break\n      case 'today':\n        change = this.core.today()\n        break\n    }\n\n    if (!change) return\n\n    this.applyChange(change, {\n      action: action === 'today' ? 'today' : undefined,\n      fireCallbacks: true\n    })\n  }\n\n  private triggerEvents(change: StateChange<T>): void {\n    const events = this.options.clickEvents\n    if (!events) return\n\n    const prev = change.previous\n    const curr = change.current\n    const newStart = curr.intervalStart\n    const oldStart = prev.intervalStart\n    const newEnd = curr.intervalEnd\n    const oldEnd = prev.intervalEnd\n\n    const monthArg: [any] = [curr.month.value()]\n    const intervalArg: [any, any] = [\n      curr.intervalStart.value(),\n      curr.intervalEnd.value()\n    ]\n\n    const nextInterval = newStart.isAfter(oldStart)\n    const prevInterval = newStart.isBefore(oldStart)\n    const intervalChanged = nextInterval || prevInterval\n\n    const monthChanged = !curr.intervalStart.hasSame(\n      prev.intervalStart,\n      'month'\n    )\n    const yearChanged = !curr.intervalStart.hasSame(prev.intervalStart, 'year')\n\n    const lengthOpt = this.options.lengthOfTime || {}\n\n    if (lengthOpt.days || lengthOpt.months) {\n      if (nextInterval && events.nextInterval) {\n        events.nextInterval.apply(this.apiContext ?? this, intervalArg)\n      }\n\n      if (prevInterval && events.previousInterval) {\n        events.previousInterval.apply(this.apiContext ?? this, intervalArg)\n      }\n\n      if (intervalChanged && events.onIntervalChange) {\n        events.onIntervalChange.apply(this.apiContext ?? this, intervalArg)\n      }\n    } else {\n      if (monthChanged && newStart.isAfter(oldStart) && events.nextMonth) {\n        events.nextMonth.apply(this.apiContext ?? this, monthArg)\n      }\n\n      if (monthChanged && newStart.isBefore(oldStart) && events.previousMonth) {\n        events.previousMonth.apply(this.apiContext ?? this, monthArg)\n      }\n\n      if (monthChanged && events.onMonthChange) {\n        events.onMonthChange.apply(this.apiContext ?? this, monthArg)\n      }\n\n      if (yearChanged && newStart.isAfter(oldStart) && events.nextYear) {\n        events.nextYear.apply(this.apiContext ?? this, monthArg)\n      }\n\n      if (yearChanged && newStart.isBefore(oldStart) && events.previousYear) {\n        events.previousYear.apply(this.apiContext ?? this, monthArg)\n      }\n\n      if (yearChanged && events.onYearChange) {\n        events.onYearChange.apply(this.apiContext ?? this, monthArg)\n      }\n    }\n  }\n\n  private buildTargetObject(\n    element: Element,\n    targetWasDay: boolean\n  ): ClndrClickTarget {\n    const target: ClndrClickTarget = {\n      element,\n      date: null,\n      events: []\n    }\n\n    if (!targetWasDay) return target\n\n    const iso = this.getTargetDateString(element)\n    if (!iso) return target\n\n    const date = this.adapter.fromISO(iso)\n    target.date = date.value() as any\n    target.events = this.findEventsForDate(date)\n    return target\n  }\n\n  private findEventsForDate(date: AdapterDate<T>): ClndrEvent[] {\n    const events = (this.options.events || []) as RuntimeEvent[]\n    const dayStart = date.startOf('day')\n    const dayEnd = date.endOf('day')\n\n    return events.filter(ev => {\n      const start = ev._clndrStartDateObject\n      const end = ev._clndrEndDateObject\n      if (!start || !end) return false\n      const beforeStart = end.isBefore(dayStart)\n      const afterEnd = start.isAfter(dayEnd)\n      return !(beforeStart || afterEnd)\n    })\n  }\n\n  private getTargetDateString(element: Element): string | null {\n    const className = element.className || ''\n    const index = className.indexOf('calendar-day-')\n    if (index === -1) return null\n    return className.substr(index + 13, 10)\n  }\n\n  private handleAdjacentDay($target: JQuery<HTMLElement>): boolean {\n    if (!this.options.adjacentDaysChangeMonth) return false\n    const classes = this.options.classes || {}\n    if ($target.hasClass(classes.lastMonth || 'last-month')) {\n      const change = this.core.back()\n      if (change) {\n        this.applyChange(change, { fireCallbacks: true })\n      }\n      return true\n    }\n    if ($target.hasClass(classes.nextMonth || 'next-month')) {\n      const change = this.core.forward()\n      if (change) {\n        this.applyChange(change, { fireCallbacks: true })\n      }\n      return true\n    }\n    return false\n  }\n\n  private applyConstraintClasses(): void {\n    const constraints = this.core.getConstraints()\n    const inactive = this.options.classes?.inactive || 'inactive'\n    const targets = this.options.targets!\n\n    const toggles: Array<[keyof ConstraintState, string | undefined]> = [\n      ['previous', targets.previousButton],\n      ['next', targets.nextButton],\n      ['previousYear', targets.previousYearButton],\n      ['nextYear', targets.nextYearButton],\n      ['today', targets.todayButton]\n    ]\n\n    for (const [key, selector] of toggles) {\n      if (!selector) continue\n      this.element.find(`.${selector}`).toggleClass(inactive, !constraints[key])\n    }\n  }\n\n  private resolveElement(element: HTMLElement | JQuery | string): JQuery {\n    if (typeof element === 'string') {\n      return $(element)\n    }\n    if ((element as any).jquery) {\n      return element as JQuery\n    }\n    return $(element as HTMLElement)\n  }\n\n  private assertSingleElement(el: JQuery): void {\n    if (el.length === 0) {\n      throw new Error('CLNDR: No element found for selector.')\n    }\n    if (el.length > 1) {\n      throw new Error(\n        'CLNDR: Multiple elements are not supported per instance.'\n      )\n    }\n  }\n\n  private resolveEventElement(\n    event: JQuery.TriggeredEvent,\n    selector: string\n  ): HTMLElement | null {\n    const current = event.currentTarget as HTMLElement | null\n    if (current && current.matches(selector)) {\n      return current\n    }\n    const target = event.target as HTMLElement | null\n    if (target) {\n      const match = target.closest(selector)\n      if (match) return match as HTMLElement\n    }\n    return null\n  }\n\n  private highlightSelectedDay(\n    iso: string,\n    selectedClass: string,\n    tokens: string[]\n  ): void {\n    const target = this.container.find(`.calendar-day-${iso}`).first()\n    if (!target.length) return\n    target.addClass(selectedClass)\n    const el = target.get(0)\n    if (!el) return\n    for (const token of tokens) {\n      if (token) {\n        el.classList.add(token)\n      }\n    }\n  }\n}\n","/**\n * DateAdapter interface and supporting types used by CLNDR core.\n *\n * The adapter provides a thin abstraction over a date library\n * (Moment/Luxon/etc.) so core code never depends on a specific runtime.\n *\n * Implementations MUST preserve legacy Moment semantics when used with\n * existing templates and options. All date math in core should be expressed\n * via this surface, never by calling the date library directly.\n */\n\n/**\n * Display width for localized weekday labels.\n * - 'narrow' → typically 1–2 chars (e.g., Su)\n * - 'short' → abbreviated (e.g., Sun)\n * - 'long' → full name (e.g., Sunday)\n */\nexport type WeekdayLabelStyle = 'narrow' | 'short' | 'long'\n\n/**\n * Supported units for start/end boundaries and comparisons.\n */\nexport type DateUnit =\n  | 'millisecond'\n  | 'second'\n  | 'minute'\n  | 'hour'\n  | 'day'\n  | 'week'\n  | 'month'\n  | 'year'\n\n/**\n * Duration-like payload for plus/minus operations.\n */\nexport type DurationLike = Partial<{\n  milliseconds: number\n  seconds: number\n  minutes: number\n  hours: number\n  days: number\n  weeks: number\n  months: number\n  years: number\n}>\n\n/**\n * Wrapper around the adapter's date value that exposes common operations.\n */\nexport interface AdapterDate<TNative = unknown> {\n  /**\n   * Return the underlying library date instance, useful for advanced\n   * consumer formatting or interop with legacy callbacks.\n   */\n  value(): TNative\n\n  /**\n   * Format this date using the adapter’s token set. Adapters implementing\n   * token normalization should map legacy tokens accordingly.\n   */\n  toISO(): string\n  format(fmt: string): string\n\n  /**\n   * Non-mutating arithmetic and boundary helpers. All methods return a\n   * new AdapterDate value and MUST NOT mutate the receiver.\n   */\n  startOf(unit: DateUnit): AdapterDate<TNative>\n  endOf(unit: DateUnit): AdapterDate<TNative>\n  plus(delta: DurationLike): AdapterDate<TNative>\n  minus(delta: DurationLike): AdapterDate<TNative>\n\n  /**\n   * Field accessors.\n   * - weekday(): ISO 1..7 (Mon=1, Sun=7)\n   * - day(): 1..31 day-of-month\n   * - daysInMonth(): count for current month\n   */\n  weekday(): number\n  day(): number\n  daysInMonth(): number\n\n  /** Comparisons against another AdapterDate */\n  isBefore(other: AdapterDate<TNative>): boolean\n  isAfter(other: AdapterDate<TNative>): boolean\n  hasSame(other: AdapterDate<TNative>, unit: DateUnit): boolean\n}\n\nexport interface DateAdapter<TNative = unknown> {\n  /** Current moment (adapter-native ‘now’) */\n  now(): AdapterDate<TNative>\n\n  /** Parsing helpers producing adapter dates. */\n  fromISO(iso: string): AdapterDate<TNative>\n  fromFormat(text: string, fmt: string): AdapterDate<TNative>\n  /** Parse a native library date value. */\n  fromNative(value: TNative): AdapterDate<TNative>\n\n  /**\n   * Locale surface.\n   * - withLocale: return a new adapter bound to the locale.\n   * - getLocale: current locale identifier.\n   * - firstDayOfWeek: 0..6 (0=Sunday) per locale.\n   * - setWeekday: set day-of-week by index where 0 is the first day-of-week\n   *   for this locale (i.e., locale-relative index within the same week).\n   * - weekdayLabels: localized labels for header generation.\n   */\n  withLocale(locale: string): DateAdapter<TNative>\n  getLocale(): string\n  firstDayOfWeek(): number\n  setWeekday(date: AdapterDate<TNative>, index: number): AdapterDate<TNative>\n  weekdayLabels(style: WeekdayLabelStyle): string[]\n\n  /**\n   * Optional format token normalization used by adapters to map between\n   * legacy Moment tokens and their runtime equivalents.\n   */\n  normalizeTokens(fmt: string): string\n}\n\n/**\n * Rotate an array by `by` steps to the left. Negative values rotate right.\n */\nexport function rotate<T>(arr: T[], by: number): T[] {\n  const n = ((by % arr.length) + arr.length) % arr.length\n  return [...arr.slice(n), ...arr.slice(0, n)]\n}\n","import { DateAdapter, rotate } from './date-adapter/adapter'\n\n/**\n * Result of options normalization including derived weekday labels.\n */\nexport interface NormalizedConfig {\n  options: ClndrOptions\n  daysOfTheWeek: string[]\n}\n\n/** @internal Default target selectors used by CLNDR. */\nconst DEFAULT_TARGETS: Required<NonNullable<ClndrOptions['targets']>> = {\n  day: 'day',\n  empty: 'empty',\n  nextButton: 'clndr-next-button',\n  todayButton: 'clndr-today-button',\n  previousButton: 'clndr-previous-button',\n  nextYearButton: 'clndr-next-year-button',\n  previousYearButton: 'clndr-previous-year-button'\n}\n\n/** @internal Default CSS class names for day states. */\nconst DEFAULT_CLASSES: Required<NonNullable<ClndrOptions['classes']>> = {\n  past: 'past',\n  today: 'today',\n  event: 'event',\n  inactive: 'inactive',\n  selected: 'selected',\n  lastMonth: 'last-month',\n  nextMonth: 'next-month',\n  adjacentMonth: 'adjacent-month'\n}\n\n/**\n * Compute weekday header labels.\n *\n * Priority:\n * 1) If `options.daysOfTheWeek` is provided (length 7), rotate by\n *    `weekOffset` and return.\n * 2) Otherwise, derive labels by formatting adapter weekdays and rotate by\n *    `weekOffset`.\n * 3) If `formatWeekdayHeader` callback is provided, call it for each header\n *    passing the adapter-native date (e.g., moment) representing the i-th\n *    weekday relative to the locale-first day within the current week.\n */\nexport function computeWeekdayLabels(\n  adapter: DateAdapter,\n  options: ClndrOptions\n): string[] {\n  const weekOffset = options.weekOffset ?? 0\n  if (options.daysOfTheWeek && options.daysOfTheWeek.length === 7) {\n    return rotate(options.daysOfTheWeek, weekOffset)\n  }\n\n  if (typeof options.formatWeekdayHeader === 'function') {\n    const start = adapter.now().startOf('week')\n    return Array.from({ length: 7 }, (_, idx) => {\n      const offset = (idx + weekOffset) % 7\n      const d = adapter.setWeekday(start, offset)\n      return options.formatWeekdayHeader!(d.value() as any)\n    })\n  }\n\n  const start = adapter.now().startOf('week')\n  const labels = Array.from({ length: 7 }, (_, idx) => {\n    const d = adapter.setWeekday(start, idx)\n    const formatted = d.format('dd') || ''\n    return formatted.charAt(0)\n  })\n\n  return rotate(labels, weekOffset)\n}\n\n/**\n * Normalize and default CLNDR options using the provided adapter.\n *\n * - Fills in default `targets` and `classes`.\n * - Ensures stable defaults for booleans and nullable values.\n * - Computes `daysOfTheWeek` using adapter + rotation and user callback.\n */\nexport function normalizeOptions(\n  adapter: DateAdapter,\n  inOptions: ClndrOptions = {}\n): NormalizedConfig {\n  const o: ClndrOptions = {\n    weekOffset: inOptions.weekOffset ?? 0,\n    showAdjacentMonths: inOptions.showAdjacentMonths ?? true,\n    trackSelectedDate: inOptions.trackSelectedDate ?? false,\n    dateParameter: 'date',\n    template: inOptions.template,\n    render: inOptions.render,\n    startWithMonth: inOptions.startWithMonth,\n    daysOfTheWeek: inOptions.daysOfTheWeek,\n    formatWeekdayHeader: inOptions.formatWeekdayHeader,\n    targets: { ...DEFAULT_TARGETS, ...(inOptions.targets || {}) },\n    classes: { ...DEFAULT_CLASSES, ...(inOptions.classes || {}) },\n    clickEvents: inOptions.clickEvents,\n    useTouchEvents: inOptions.useTouchEvents,\n    ready: inOptions.ready,\n    doneRendering: inOptions.doneRendering,\n    events: inOptions.events || [],\n    multiDayEvents: inOptions.multiDayEvents,\n    adjacentDaysChangeMonth: inOptions.adjacentDaysChangeMonth ?? false,\n    forceSixRows: inOptions.forceSixRows ?? null,\n    selectedDate: inOptions.selectedDate ?? null,\n    ignoreInactiveDaysInSelection:\n      inOptions.ignoreInactiveDaysInSelection ?? null,\n    lengthOfTime: inOptions.lengthOfTime,\n    extras: inOptions.extras,\n    constraints: inOptions.constraints ?? null,\n    moment: inOptions.moment ?? null\n  }\n\n  const daysOfTheWeek = computeWeekdayLabels(adapter, o)\n\n  return { options: o, daysOfTheWeek }\n}\n","import type { DateAdapter } from './date-adapter/adapter'\nimport { createLuxonAdapter } from './date-adapter/luxon-adapter'\nimport { createMomentAdapter } from './date-adapter/moment-adapter'\nimport { ClndrCore, type StateChange } from './core'\nimport { ClndrDOM } from './dom'\nimport { normalizeOptions } from './config'\nimport { createRenderer } from './templates'\n\n/**\n * Primary CLNDR factory. Creates a fully TypeScript-backed calendar instance\n * that renders via the DOM integration layer and exposes the familiar API.\n */\nexport function clndr(\n  element: HTMLElement | JQuery | string,\n  userOptions: ClndrOptions = {}\n): Clndr {\n  const adapter = selectAdapter(userOptions)\n  const normalized = normalizeOptions(adapter, userOptions)\n  normalized.options.daysOfTheWeek =\n    normalized.options.daysOfTheWeek || normalized.daysOfTheWeek\n\n  const core = new ClndrCore(adapter, normalized.options)\n  const renderer = createRenderer(normalized.options)\n  const dom = new ClndrDOM(element, core, renderer, adapter)\n  const api = createPublicApi(core, dom)\n\n  dom.attachApi(api)\n  dom.render()\n\n  if (typeof normalized.options.ready === 'function') {\n    normalized.options.ready.apply(api, [])\n  }\n\n  return api\n}\n\nfunction selectAdapter(options: ClndrOptions): DateAdapter<any> {\n  if (options.dateAdapter) return options.dateAdapter\n\n  const envPref =\n    typeof process !== 'undefined' && process.env?.DATE_LIB\n      ? process.env.DATE_LIB\n      : null\n  const preferred = options.dateLibrary || envPref || 'moment'\n\n  if (preferred === 'luxon') {\n    return createLuxonAdapter(options.locale, options.zone)\n  }\n\n  return createMomentAdapter(options.locale)\n}\n\nfunction createPublicApi(core: ClndrCore<any>, dom: ClndrDOM<any>): Clndr {\n  const options = core.getOptions()\n\n  const applyNav = (\n    change: StateChange | null,\n    opts: { action?: 'today'; withCallbacks?: boolean } = {}\n  ) => {\n    if (!change) return\n    dom.applyChange(change, {\n      action: opts.action,\n      fireCallbacks: opts.withCallbacks === true\n    })\n  }\n\n  const api: Clndr = {\n    options,\n    element: dom.element[0],\n\n    render() {\n      dom.render()\n      return this\n    },\n\n    forward(opts) {\n      applyNav(core.forward(), { withCallbacks: opts?.withCallbacks })\n      return this\n    },\n\n    next(opts) {\n      return this.forward(opts)\n    },\n\n    back(opts) {\n      applyNav(core.back(), { withCallbacks: opts?.withCallbacks })\n      return this\n    },\n\n    previous(opts) {\n      return this.back(opts)\n    },\n\n    nextYear(opts) {\n      applyNav(core.nextYear(), { withCallbacks: opts?.withCallbacks })\n      return this\n    },\n\n    previousYear(opts) {\n      applyNav(core.previousYear(), { withCallbacks: opts?.withCallbacks })\n      return this\n    },\n\n    today(opts) {\n      applyNav(core.today(), {\n        action: 'today',\n        withCallbacks: opts?.withCallbacks\n      })\n    },\n\n    setMonth(newMonth, opts) {\n      applyNav(core.setMonth(newMonth), { withCallbacks: opts?.withCallbacks })\n      return this\n    },\n\n    setYear(newYear, opts) {\n      applyNav(core.setYear(newYear), { withCallbacks: opts?.withCallbacks })\n      return this\n    },\n\n    setExtras(extras) {\n      core.setExtras(extras)\n      dom.render()\n      return this\n    },\n\n    setEvents(events) {\n      core.setEvents(events)\n      dom.render()\n      return this\n    },\n\n    addEvents(events, reRender = true) {\n      core.addEvents(events)\n      if (reRender !== false) {\n        dom.render()\n      }\n      return this\n    },\n\n    removeEvents(match) {\n      core.removeEvents(match)\n      dom.render()\n      return this\n    },\n\n    destroy() {\n      dom.destroy()\n    }\n  }\n\n  return api\n}\n","import $ from 'jquery'\n\nimport { clndr as createClndr } from './facade'\n\ndeclare global {\n  interface JQuery {\n    clndr(options?: ClndrOptions): Clndr\n  }\n}\n\nexport function registerJQueryPlugin(): void {\n  if (!$.fn) return\n\n  $.fn.clndr = function (this: JQuery, options?: ClndrOptions): Clndr {\n    if (this.length === 0) {\n      throw new Error('CLNDR: No element selected for jQuery plugin.')\n    }\n    if (this.length > 1) {\n      throw new Error(\n        'CLNDR: Please initialize one calendar per jQuery collection.'\n      )\n    }\n\n    return createClndr(this[0], options)\n  }\n}\n\nif (typeof window !== 'undefined' && (window as any).jQuery) {\n  registerJQueryPlugin()\n}\n","/**\n * Render helpers for converting template data into HTML.\n * These are intentionally minimal and framework-agnostic to allow consumers\n * to plug in their own templating systems.\n */\nimport { TemplateRenderer } from './templates'\n\n/**\n * Minimal render instruction set describing the resulting HTML string.\n * Future additions may capture targeted DOM mutation plans.\n */\nexport interface RenderInstructions {\n  html: string\n}\n\n/**\n * Render with a provided template renderer and arbitrary template data.\n *\n * @param renderer A function that produces HTML for the given data\n * @param data Arbitrary data object expected by the template\n * @returns RenderInstructions containing the HTML string\n */\nexport function renderWithTemplate(\n  renderer: TemplateRenderer,\n  data: any\n): RenderInstructions {\n  return { html: renderer(data) }\n}\n"],"names":["LuxonAdapterDate","constructor","dt","owner","this","value","toISO","toISODate","format","fmt","Info","weekdays","locale","getLocale","weekday","toFormat","slice","mapped","normalizeTokens","setLocale","startOf","unit","desired","firstDayOfWeek","isoDesired","daysBack","adjusted","minus","days","endOf","start","plus","delta","day","daysInMonth","isBefore","other","toMillis","isAfter","hasSame","LuxonDateAdapter","zone","now","localized","DateTime","set","zoned","setZone","fromISO","iso","fromFormat","text","fromNative","isDateTime","fromJSDate","withLocale","loc","toLowerCase","startsWith","setWeekday","date","index","base","target","weekdayLabels","style","raw","fdow","startIndex","out","replace","createLuxonAdapter","MomentAdapterDate","m","toISOString","clone","milliseconds","add","seconds","minutes","hours","weeks","months","years","subtract","isoWeekday","isSame","MomentDateAdapter","momentLib","localeData","targetDow","ld","weekdaysMin","weekdaysShort","createMomentAdapter","parseToAdapterDate","adapter","v","initState","options","lot","lengthOfTime","month","intervalStart","intervalEnd","startMonth","startDate","startWithMonth","weekOffset","_a","hasDays","_b","hasMonths","_c","selectedDate","DEFAULT_TEMPLATE","trim","compile","template","re","data","_m","key","parts","String","split","cur","p","baseTemplateData","daysOfTheWeek","extras","year","eventsThisMonth","eventsLastMonth","eventsNextMonth","numberOfRows","eventsThisInterval","createRenderer","render","underscore","globalThis","_","ISO_FORMAT","ClndrCore","events","constraintState","next","previous","nextYear","previousYear","today","constraintStart","constraintEnd","currentIntervalStart","interval","ensureLengthDefaults","state","bootstrapConstraints","setEvents","getOptions","getState","getConstraints","updateConstraintState","usesDaysInterval","Boolean","usesMonthsInterval","setExtras","processed","multiDayEvents","addMultiDayDateObjects","addDateObjects","addEvents","removeEvents","match","filter","ev","setSelectedDate","forward","step","updateState","prev","span","end","back","ref","parseDateInput","weekdayIndex","offset","setMonth","newMonth","console","warn","Number","resolveMonthDate","setYear","newYear","monthIndex","padMonth","setIntervalStart","newDate","parsed","buildTemplateData","createDaysObject","Math","ceil","length","intervalEvents","rows","count","i","push","monthStart","monthEnd","mutator","current","Date","dateParameter","map","runtime","_clndrStartDateObject","_clndrEndDateObject","config","startRaw","singleDay","endRaw","endDate","eventsInRange","startDay","endDay","beforeStart","afterEnd","showAdjacentMonths","lastMonthStart","lastMonthEnd","nextMonthStart","nextMonthEnd","diff","filler","createDayObject","calendarDay","classes","targetsEmpty","lastMonth","cursor","nextMonth","forceSixRows","WEEK_LENGTH","_d","monthEvents","dayStart","dayEnd","eventsToday","targetsDay","properties","isToday","isInactive","isAdjacentMonth","nowStart","past","event","adjacentMonth","_e","_f","_g","_h","inactive","_j","selected","_k","join","partial","targets","empty","relative","constraints","oneYearAgo","oneYearFromEnd","input","tokens","ClndrDOM","element","core","renderer","apiContext","resolveElement","assertSingleElement","html","container","find","eventType","useTouchEvents","eventName","bindEvents","attachApi","api","applyConstraintClasses","doneRendering","apply","applyChange","change","opts","fireCallbacks","action","clickEvents","triggerEvents","destroy","off","remove","on","handleDayClick","handleEmptyClick","nextButton","preventDefault","handleNavigation","previousButton","nextYearButton","previousYearButton","todayButton","resolveEventElement","$target","$","adjacentHandled","handleAdjacentDay","trackSelectedDate","inactiveClass","selectedClass","selectedTokens","hasClass","ignoreInactive","ignoreInactiveDaysInSelection","getTargetDateString","token","removeClass","classList","highlightSelectedDay","addClass","className","click","payload","buildTargetObject","undefined","curr","newStart","oldStart","monthArg","intervalArg","nextInterval","prevInterval","intervalChanged","monthChanged","yearChanged","lengthOpt","previousInterval","onIntervalChange","previousMonth","onMonthChange","onYearChange","targetWasDay","findEventsForDate","indexOf","substr","adjacentDaysChangeMonth","toggles","selector","toggleClass","jquery","el","Error","currentTarget","matches","closest","first","get","rotate","arr","by","n","DEFAULT_TARGETS","DEFAULT_CLASSES","normalizeOptions","inOptions","o","formatWeekdayHeader","ready","moment","Array","from","idx","d","charAt","computeWeekdayLabels","clndr","userOptions","dateAdapter","envPref","process","env","DATE_LIB","dateLibrary","selectAdapter","normalized","dom","applyNav","withCallbacks","reRender","createPublicApi","registerJQueryPlugin","fn","createClndr","window","jQuery"],"mappings":"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"}